> __TODO__: spec of exported make.js location and implications.

MakeJS Elements
===============

This documentation describes make.js elements behavior, special attributes and implementation details.

GroupElement
------------

The group element is a particular element that can be viewed as an alias to multiple elements of the same kind.

### Special attributes

 - `elements`: the list of elements this group is an alias for
 - `path`: allow to change the relative path used by defined sub elements

FileElement
-----------

The file element is a bit special due to how his name his handled.
Because the name of a file element can refer to multiple file, one file element in the make.js file can be expanded to a lot of file element.

The `name` attribute can be:

 - the path to the file
 - a path grepping expression to one or multiple files
 - a regular expression
 - a filter method (`(relativePath: string) => boolean`)


ComponentElement
----------------

A component element is an element that can be injected into another component.

The injection of all components required by a specific target/environment/variant is done just before the creation of the target node in the build graph.
Delaying the injection until the last moment is required because all components must be known before the injection can occur with specified behavior.

### Injection specification

 - if the attribute is an array, at it to the end of array
 - if the attribute is not array
   - if the attribute was already defined by the injection target, do nothing
   - if the attribute is defined by multiple components, raise a warning
   - if the attribute is defined in only one injected component, add it

### Special attributes

 - `components`: A list of component elements

EnvironmentElement
------------------

### Special attributes

 - `compatibleEnvironments`: a list of compatible environment names

TargetElement
-------------

A special and very limited injection of components is made at resolution time.
This exception to how components are injected is made for the `environments` attribute because:

  - the list of `environments` is required to pick the environement
  - `environments` are often provided by components injection
  - `environmentsByEnvironment` attribute has no meaning, thus it is ignored

### Special attributes

 - `type`: a string that gives the type of target this is (ie. CXXLibrary, javascript, ...)
 - `environments`: a list of environment elements this target can be built for
 - `targets`: a list of target name this target requires before being able to be built
 - `exports`: a list of components to exports for other targets

TargetExportsElement
-------------------

Holds exported make.js definition of a target + environment  +variant. 
It is either directly generated by the corresponding target if the project that hold the target is loaded or by loading the exported make.js.

This element is a component, which means is attributes are injected to the requesting target.

Targets automatically fills the `auto` component with the `fillExportsAutoElement` method.

BuildTargetElement
------------------

This element is the result of the injection of environment related elements (EnvironmentElement, TargetExportsElement, ...) to the target element.
It's used directly by the target `attributes` property.

#### `constructor`

 - setup the is, variant and environment attributes
 - inject target element attributes to itself
 - inject the environment
 - inject components tree

the resolution of delayed elements occur at the injection step
 
#### `__injectElements(reporter: Reporter, elements: Element[])`

Inject attributes of each elements with respect to some constraints.

If the injected attribute is an array for each elements, then the resulting value is the concatenation of the arrays.
Othewize if the attribute is defined by multiple elements, nothing is done and a warning is raised.
If the attribute is defined by one element and doesn't exists in the final element, it's injected.
